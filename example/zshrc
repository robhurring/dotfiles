PROFILE_STARTUP=${PROFILE_STARTUP:-"0"}
if [[ "$PROFILE_STARTUP" == "1" ]]; then
  PS4=$'%D{%M%S%.} %N:%i> '
  exec 3>&2 2>/tmp/zsh.$$.profile
  setopt xtrace prompt_subst
fi

# setup our env to point to the dotfiles
export DOTFILES=~/.dotfiles
export ZSH=~/.zsh
export ZSH_THEME=default
export ZSH_MODE="vi"
export ZSH_VI_ESC="jk"
export EDITOR="vim"
export SHELL=/usr/local/bin/zsh

plugins=(tmux fzf git fasd vi-mode docker)

# load our zsh environment
[[ -f ~/.zsh/init.zsh ]] && . ~/.zsh/init.zsh

# ---> Local Config

# don't autofetch for git rprompt status
# export GIT_AUTO_FETCH=0

# Disable for OSX
# export LS_OPTIONS=''

# Custom prompt color
export THEME_PROMPT_COLOR="%B%F{yellow}"
export THEME_VI_PROMPT_COLOR="%b%K{magenta}%F{white}"

# Add user and host before the path
export THEME_PATH_BEFORE="%n@%m "

# ---> Some common aliases
# alias less='less -R'
# alias -g ls="ls $LS_OPTIONS"
# alias cdd='cd ~/Desktop'
# alias bc='bundle console'
# alias c='cd /usr/local/Cellar'
# alias grep='pcregrep --color=auto'

# Development
alias e=vim
# alias erc='e ~/.zshrc'
# alias edf="pushd $DOTFILES && e && popd"
# alias ev='pushd ~/.dotvim && e vimrc && popd'
# alias cdg="cd $GOPATH/src/github.com/$(git config github.user)"
# alias rsa='auto-bundle-exec rspec -fd'
# alias rs='rsa --fail-fast'
# alias rake="auto-bundle-exec rake"
# alias guard="auto-bundle-exec guard"
# alias pry="auto-bundle-exec pry"

# Tmux (use with tmux plugin)
# alias tml="tmux list-sessions"
# alias tma=tmux-go
# alias tmd="tmux detach"
# alias tmx="tmux kill-session -t"

# Tig
# alias ts='tig status'
# alias tb='tig blame'
# alias ta='tig --all'
# alias ts='tig status'
# alias tg='tig grep'
# function tl(){
#   $(git log --all --decorate --format='commit %h %an: %s' $* | tig)
# }

# Fasd
# alias j=z
# alias el='fasd -ft -e $EDITOR -b viminfo'
# alias ef='fasd -ft -e $EDITOR'
# bindkey '^X^D' fasd-complete-d

# ---> Neovim

# export NVIM_TUI_ENABLE_TRUE_COLOR=1
# export NVIM_LISTEN_ADDRESS=/tmp/neovim.sock

# ---> FZF (requires fzf plugin)

# export FUZZY_SEARCH_PATHS="~/Projects"
# alias cds=fuzzy-cds
# alias co=fuzzy-co
# alias eb=fuzzy-bundle-open
# alias ef=fuzzy-edit
# alias cdf=fuzzy-cd
# alias fkill=fuzzy-kill

# function fzf-fuzzy-cds() {
#   fuzzy-cds $1
#   zle reset-prompt
# }
# zle -N fzf-fuzzy-cds
# bindkey "^ " fzf-fuzzy-cds

# function fzf-fuzzy-co() {
#   co
#   zle reset-prompt
# }
# zle -N fzf-fuzzy-co
# bindkey "^b" fzf-fuzzy-co

# function fzf-fuzzy-tmux() {
#   fuzzy-tmux-session "$1"
#   zle reset-prompt
# }
# zle -N fzf-fuzzy-tmux
# bindkey "^o" fzf-fuzzy-tmux

# function vs(){
#   local session
#
#   if [ -n $1 ]; then
#     session=$(ls ~/.vim/sessions|sed -e 's/\.session$//g'|$FZF_COMMAND -1 --query=$1)
#     [[ $session != "" ]] && vim +"OpenSession ${session}"
#   else
#     vim +"OpenSession ${1}"
#   fi
# }

# ---> Golang

# export GOPATH=$HOME/Go
# export GOBIN=$GOPATH/bin
# export PATH="$PATH:$GOBIN"

# ---> Paths

# export PATH="$PATH:$DOTFILES/node_modules/.bin"
[ -d "$HOME/bin" ] && PATH="$HOME/bin:$PATH"

if [[ "$PROFILE_STARTUP" == "1" ]]; then
  unsetopt xtrace
  exec 2>&3 3>&-
fi
